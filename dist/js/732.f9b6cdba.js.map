{"version":3,"file":"js/732.f9b6cdba.js","mappings":"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","sources":["webpack://vuejs-essential/./src/views/Search.vue","webpack://vuejs-essential/src/views/Search.vue","webpack://vuejs-essential/./src/views/Search.vue?a8fc","webpack://vuejs-essential/./src/views/Search.vue?1f58"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"panel panel-default list-panel search-results\"},[_c('div',{staticClass:\"panel-heading\"},[_c('h3',{staticClass:\"panel-title\"},[_c('i',{staticClass:\"fa fa-search\"}),_vm._v(\" 关于 “\"),_c('span',{staticClass:\"highlight\"},[_vm._v(_vm._s(_vm.keyword))]),_vm._v(\"” 的搜索结果, 共 \"+_vm._s(_vm.results.length)+\" 条 \")]),_c('div',{staticClass:\"pull-right\",staticStyle:{\"margin-top\":\"-10px\"}},_vm._l((_vm.filters),function(item){return _c('button',{staticClass:\"btn btn-default btn-sm\",attrs:{\"disabled\":item.filter === _vm.filter,\"href\":\"javascript:;\"},on:{\"click\":function($event){return _vm.getArticlesByKeyword(_vm.keyword, item.filter)}}},[_c('i',{class:`fa fa-${item.icon}`}),_vm._v(\" \"+_vm._s(item.title)+\" \")])}),0)]),_c('div',{staticClass:\"panel-body\"},[_vm._l((_vm.results),function(result){return _c('div',{staticClass:\"result\"},[_c('h2',{staticClass:\"title\"},[_c('router-link',{attrs:{\"to\":`/articles/${result.id}/content`}},[_c('span',{domProps:{\"innerHTML\":_vm._s(result.title)}})]),_c('small',[_vm._v(\"by\")]),_c('router-link',{attrs:{\"to\":`/${result.user.name}`}},[_c('img',{staticClass:\"avatar avatar-small\",attrs:{\"src\":result.user.avatar}}),_c('small',[_vm._v(_vm._s(result.user.name))])])],1),_c('div',{staticClass:\"info\"},[_c('span',{staticClass:\"url\"},[_c('router-link',{attrs:{\"to\":`/articles/${result.id}/content`}},[_vm._v(\" \"+_vm._s(result.url)+\" \")])],1),_c('span',{staticClass:\"date\"},[_vm._v(\" \"+_vm._s(_vm._f(\"moment\")(result.created_at,'from', { startOf: 'minute' }))+\" ⋅ \"),_c('i',{staticClass:\"fa fa-thumbs-o-up\"}),_vm._v(\" \"+_vm._s(result.likeUser && result.likeUser.length || 0)+\" ⋅ \"),_c('i',{staticClass:\"fa fa-comments-o\"}),_vm._v(\" \"+_vm._s(result.replies && result.replies.length || 0)+\" \")])]),_c('div',{staticClass:\"desc\",domProps:{\"innerHTML\":_vm._s(result.body)}}),_c('hr')])}),(!_vm.results.length)?_c('div',{staticClass:\"empty-block\"},[_vm._v(\" 没有任何数据~~ \")]):_vm._e()],2)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"panel panel-default list-panel search-results\">\n        <div class=\"panel-heading\">\n            <h3 class=\"panel-title\">\n                <i class=\"fa fa-search\"></i>\n                关于 “<span class=\"highlight\">{{ keyword }}</span>” 的搜索结果, 共 {{ results.length }} 条\n            </h3>\n            <!-- 排序方式列表 -->\n            <div class=\"pull-right\" style=\"margin-top:-10px\">\n                <button v-for=\"item in filters\"\n                        :disabled=\"item.filter === filter\"\n                        class=\"btn btn-default btn-sm\"\n                        href=\"javascript:;\"\n                        @click=\"getArticlesByKeyword(keyword, item.filter)\"\n                >\n                    <i :class=\"`fa fa-${item.icon}`\"></i>\n                    {{ item.title }}\n                </button>\n            </div>\n        </div>\n        <div class=\"panel-body\">\n            <div v-for=\"result in results\" class=\"result\">\n                <h2 class=\"title\">\n                    <router-link :to=\"`/articles/${result.id}/content`\">\n                        <span v-html=\"result.title\"></span>\n                    </router-link>\n                    <small>by</small>\n                    <router-link :to=\"`/${result.user.name}`\">\n                        <img :src=\"result.user.avatar\" class=\"avatar avatar-small\">\n                        <small>{{ result.user.name }}</small>\n                    </router-link>\n                </h2>\n                <div class=\"info\">\n                    <span class=\"url\">\n                        <router-link :to=\"`/articles/${result.id}/content`\">\n                            {{ result.url }}\n                        </router-link>\n                    </span>\n                    <span class=\"date\">\n                        {{ result.created_at | moment('from', { startOf: 'minute' }) }} ⋅\n                        <i class=\"fa fa-thumbs-o-up\"></i> {{ result.likeUser && result.likeUser.length || 0 }} ⋅\n                        <i class=\"fa fa-comments-o\"></i> {{ result.replies && result.replies.length || 0 }}\n                    </span>\n                </div>\n                <div class=\"desc\" v-html=\"result.body\"></div>\n                <hr>\n            </div>\n            <div v-if=\"!results.length\" class=\"empty-block\">\n                没有任何数据~~\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import {search} from \"@/api/topic\";\n\n    export default {\n        name: 'Search',\n        data() {\n            return {\n                keyword: '', // 关键字\n                results: [], // 搜索结果\n                filter: 'default', // 默认排序方式\n                filters: [ // 排序方式列表\n                    {\n                        filter: 'default',\n                        title: '相关性排序',\n                        icon: 'random'\n                    },\n                    {\n                        filter: 'vote',\n                        title: '点赞数排序',\n                        icon: 'thumbs-up'\n                    }\n                ]\n            }\n        },\n        beforeRouteEnter(to, from, next) {\n            next(vm => {\n                // 确认渲染该组件的对应路由时，获取搜索结果\n                vm.getArticlesByKeyword(to.query.q)\n            })\n        },\n        // 当前路由改变，该组件被复用时，获取搜索结果\n        beforeRouteUpdate(to, from, next) {\n            this.getArticlesByKeyword(to.query.q)\n            next()\n        },\n        // 离开该组件的对应路由时，清空搜索值\n        beforeRouteLeave(to, from, next) {\n            this.$store.commit('UPDATE_SEARCH_VALUE', '')\n            next()\n        },\n        methods: {\n            // 使用关键字 keyword 获取搜索结果\n            // 添加 filter 参数，以按指定方式排序\n            getArticlesByKeyword(keyword, filter) {\n                if (keyword) {\n                    this.keyword = keyword\n                    // 更新排序方式\n                    if (filter) this.filter = filter\n                    let params = {\n                        include: 'user,category,likeUser,replies',\n                        keyword: keyword,\n                        filter: this.filter\n                    }\n                    search(params).then((res) => {\n                        this.results = this.heightLight(res.data, keyword)\n                    })\n                    // 需要提交事件类型，以更新搜索框的值\n                    // this.$store.commit('UPDATE_SEARCH_VALUE', keyword)\n                    // 传入 filter 参数\n                    // this.results = this.$store.getters.getArticlesByKeyword(keyword, filter)\n                }\n            },\n            heightLight(articles, keyword) {\n                // 搜索结果\n                let results = []\n                if (Array.isArray(articles)) {\n                    articles.forEach((article) => {\n                        let {id, title, body} = article\n                        // 该正则表示文章标题或内容中的关键字\n                        const regex = new RegExp(`(${keyword})`, 'gi')\n\n                        if (title.indexOf(keyword) !== -1 || body.indexOf(keyword) !== -1) {\n                            // 使用 state.origin 代替 location.origin\n                            const url = `${this.$store.state.origin}/articles/${id}/content`\n                            // 给文章标题中的关键字加上高亮，$1 匹配第一个括号的内容\n                            title = title.replace(regex, '<span class=\"highlight\">$1</span>')\n                            // 给文章内容中的关键字加上高亮，只取内容前 100 个字\n                            body = body.substr(0, 100).replace(regex, '<span class=\"highlight\">$1</span>')\n                            // 等价于 results.push(Object.assign({}, article, { url: url, title: title, content: content }))\n                            results.push({...article, ...{url, title, body}})\n                        }\n                    })\n                }\n                return results\n            },\n        }\n    }\n</script>\n\n<style scoped>\n    .result a:hover, .result a:focus {\n        color: #d6514d;\n        transition: color .15s ease;\n    }\n\n    .panel-title .btn {\n        margin-left: 5px;\n    }\n</style>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Search.vue?vue&type=template&id=0b444bd8&scoped=true&\"\nimport script from \"./Search.vue?vue&type=script&lang=js&\"\nexport * from \"./Search.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Search.vue?vue&type=style&index=0&id=0b444bd8&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0b444bd8\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","keyword","results","length","staticStyle","_l","filters","item","attrs","filter","on","$event","getArticlesByKeyword","class","icon","title","result","id","domProps","user","name","avatar","url","_f","created_at","startOf","likeUser","replies","body","_e","staticRenderFns","data","beforeRouteEnter","next","vm","beforeRouteUpdate","beforeRouteLeave","methods","include","search","heightLight","articles","component"],"sourceRoot":""}